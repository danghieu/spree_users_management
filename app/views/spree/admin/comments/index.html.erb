
<% content_for :page_title do %>
  <%= Spree.t(:comments) %>
<% end %>

<%= form_tag update_status_admin_comments_url, method: :put do %>
<div class ="comment-tools">
  <div class="comment-action col-md-4">
    <div class="form-group col-md-8">
      <%= select_tag "comment[status]",options_for_select([["APPROVE", 1],["SPAM", 2],["TRASH", 3]], @status),:class => 'form-control '%>
    </div>
      <button data-confirm="Are you sure?" class="btn btn-delete btn-comment-action btn-success" name="" >APPLY</button>
  </div>

  <div class="comment-filter col-md-4">
      <div class="form-group col-md-8">
        <%= select_tag "filter",options_for_select([["All Comments", "all"],["PENDING", 0],["APPROVED", 1],["SPAM", 2],["TRASH", 3]], @filter),:class => 'form-control '%>
      </div>
      <a class="btn btn-success" id="btn-comment-filter" href="/admin/comments">APPLY</a>
  </div>
</div>
<table class="table table-striped table-hover">
  <thead align="center">
    <tr>
      <th></th>
     <th class="col-md-1">Status</th> 
      <th class="col-md-2"><%= Spree.t(:auther) %></th>
      <th class="col-md-4">Comment</th> 
      <th class="col-md-2">Comment on</th> 
      <th class="col-md-3">Actions</th>
    </tr>
  </thead>

  <tbody>
    <% @comments.each do |ob| %>
      <tr>
        <td ><%= check_box_tag "comments[]", ob.id %></td>
        <td > 
          <span style="color:white;" class="btn btn-lagre btn-block <%= @status[ob.status] %>"><%= @status[ob.status] %></span>
        </td>
        <td ><%= link_to ob.user.try(:email), edit_admin_user_path(ob.user) %></td>
        <td >
          <time datetime="<%= ob.created_at.strftime("%Y-%m-%d")%>" class="icon comment-at">
            <em><%= ob.created_at.strftime("%Y")%></em>
            <strong><%= ob.created_at.strftime("%B")%></strong>
            <span><%= ob.created_at.strftime("%d")%></span>
          </time>

          <div class= "comment-body">
          <div class="area">
              <div class="bubble">
                  <a href="/admin/comments/<%= ob.id%>/edit"> 
                    <%= truncate(ob.body, escape: false){ }%>
                  </a>
              </div>
          </div>
          
          </div>
        </td>
        <td >
        <%=  mini_image ob.product %>
        <%= link_to ob.product.try(:name), edit_admin_product_path(ob.product) %>
        </td>
        <td id= "<%=ob.id%>" class="actions" data-hook="admin_products_index_row_actions">
            <a id="1" class="btn btn-approve btn-success btn-sm icon-link with-tip action-edit no-text" data-action="approve" title="" href="" data-original-title="Approve"><span class="icon icon-ok"></span> 
            </a>
            &nbsp;
            <%= link_to_edit ob, :no_text => true, :class => 'edit' if can?(:edit, ob) %>
            &nbsp;
            <a id="2" class="btn btn-spam btn-warning btn-sm icon-link with-tip action-edit no-text" data-action="Spam" title="" href="" data-original-title="Spam"><span class="icon icon-warning-sign"></span> 
            </a>
            &nbsp;
            <%= link_to_delete ob, :no_text => true if can?(:delete, ob) %>   
          </td>
      </tr>
    <% end %>
  </tbody>
</table>
<%end%>
<a href="/add"> </a>
<br>

<script type="text/javascript">
   
  $('#filter').on('change', function() {
    var href = "/admin/comments?filter=" + this.value;
    $("#btn-comment-filter").attr("href", href);
  });

  $(".btn-approve").click(function() {
    var status = $(this).attr('id');
    var comments=$(this).parent().attr('id');
    $.ajax('/admin/comments/update_status', {
        type: "put",
        data: { comment: {status : status},comments:comments },
        success: function(data){
          window.location.reload(true);
        }
    });
  });

  $(".btn-spam").click(function() {
    var status = $(this).attr('id');
    var comments=$(this).parent().attr('id');
    $.ajax('/admin/comments/update_status', {
        type: "put",
        data: { comment: {status : status},comments:comments },
        success: function(data){
          window.location.reload(true);
        }
    });
  });

</script>